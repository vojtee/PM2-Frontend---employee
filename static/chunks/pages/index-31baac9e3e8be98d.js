(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(8698)}])},7309:function(e,t,s){"use strict";s.d(t,{k:function(){return c}});var a=s(7297),n=s(5152),r=s.n(n),i=s(948);function o(){let e=(0,a.Z)([""]);return o=function(){return e},e}let l=r()(()=>Promise.all([s.e(279),s.e(229)]).then(s.bind(s,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1,loading:()=>null}),c=(0,i.ZP)(l)(o())},8698:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var a=s(5893),n=s(9008),r=s.n(n),i=s(7357),o=s(1426),l=s(6242),c=s(4267),d=s(5861),h=s(5582),u=s(8334),x=s(7344),p=s(5697),y=s.n(p),g=s(8445),m=s(9661),j=s(3219),Z=s(2734),f=s(7309),w=s(4855),v=s(7294);let S=()=>{let e=(0,Z.Z)();return{chart:{background:"transparent",stacked:!1,toolbar:{show:!1}},colors:[e.palette.primary.main,e.palette.secondary.main],dataLabels:{enabled:!1},fill:{opacity:1,type:"solid"},grid:{borderColor:e.palette.divider,strokeDashArray:2,xaxis:{lines:{show:!1}},yaxis:{lines:{show:!0}}},legend:{show:!1},plotOptions:{bar:{columnWidth:"40px"}},stroke:{colors:["transparent"],show:!0,width:2},theme:{mode:e.palette.mode},xaxis:{axisBorder:{color:e.palette.divider,show:!0},axisTicks:{color:e.palette.divider,show:!0},categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],labels:{offsetY:5,style:{colors:e.palette.text.secondary}}},yaxis:{labels:{formatter:e=>"".concat(e),offsetX:-10,style:{colors:e.palette.text.secondary}}}}},b=e=>{let{chartSeries:t,sx:s}=e,n=S();return(0,a.jsxs)(l.Z,{sx:s,children:[(0,a.jsx)(g.Z,{avatar:(0,a.jsx)(m.Z,{sx:{backgroundColor:"info.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(j.Z,{children:(0,a.jsx)(w.Z,{})})}),title:"Issues per month"}),(0,a.jsx)(c.Z,{children:(0,a.jsx)(f.k,{height:350,options:n,series:t,type:"bar",width:"100%"})})]})};b.protoTypes={chartSeries:y().array.isRequired,sx:y().object};var k=s(2764),P=s(8462),C=s(891),M=s(9334),D=s(9305),O=s(2912);let T=e=>{let{notifications:t,sx:s}=e,[n,r]=(0,v.useState)(0),i=(e,t)=>{r(t)},o=t.slice(4*n,4*n+4);return(0,a.jsxs)(l.Z,{sx:s,children:[(0,a.jsx)(g.Z,{avatar:(0,a.jsx)(m.Z,{sx:{backgroundColor:"error.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(j.Z,{children:(0,a.jsx)(k.Z,{})})}),title:"Notifications",sx:{marginBottom:0}}),(0,a.jsx)(c.Z,{children:(0,a.jsx)(P.Z,{sx:{paddingBottom:0,paddingTop:0},children:o.map((e,t)=>{let s=t<o.length-1,n=(0,O.Z)(e.dateOfCreation,"dd/MM/yyyy HH:mm");return(0,a.jsx)(C.ZP,{divider:s,children:(0,a.jsx)(M.Z,{primary:e.description,secondary:(0,a.jsx)(d.Z,{variant:"caption",color:"textSecondary",children:n})})},e.id)})})}),(0,a.jsx)(D.Z,{component:"div",count:t.length,rowsPerPage:4,page:n,onPageChange:i,rowsPerPageOptions:[]})]})};T.propTypes={notifications:y().array.isRequired,sx:y().object};var L=s(55),N=s(940),_=s(6447),B=s(1088);let I=e=>{let t=(0,Z.Z)();return{chart:{background:"transparent"},colors:[t.palette.warning.main,t.palette.success.main],dataLabels:{enabled:!1},labels:e,legend:{show:!1},plotOptions:{pie:{expandOnClick:!1}},states:{active:{filter:{type:"none"}},hover:{filter:{type:"none"}}},stroke:{width:0},theme:{mode:t.palette.mode},tooltip:{fillSeriesColor:!1}}},E={Solving:(0,a.jsx)(j.Z,{style:{color:"F79009"},children:(0,a.jsx)(N.Z,{})}),Solved:(0,a.jsx)(j.Z,{style:{color:"#10B981"},children:(0,a.jsx)(L.Z,{})})},Y=e=>{let{chartSeries:t,labels:s,sx:n}=e,r=I(s);return(0,a.jsxs)(l.Z,{sx:n,children:[(0,a.jsx)(g.Z,{avatar:(0,a.jsx)(m.Z,{sx:{backgroundColor:"success.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(j.Z,{children:(0,a.jsx)(B.Z,{})})}),title:"This month's issues & their statuses"}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(f.k,{height:300,options:r,series:t,type:"donut",width:"100%"}),(0,a.jsx)(_.Z,{alignItems:"center",direction:"row",justifyContent:"center",spacing:2,sx:{mt:2},children:t.map((e,t)=>{let n=s[t];return(0,a.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[E[n],(0,a.jsx)(d.Z,{sx:{my:1},variant:"h6",children:n}),(0,a.jsx)(d.Z,{color:"text.secondary",variant:"subtitle2",children:e})]},n)})})]})]})};Y.propTypes={chartSeries:y().array.isRequired,labels:y().array.isRequired,sx:y().object},s(2662);var R=s(3703),A=s(7844),F=s(6822);let G=()=>{let e=(0,F.Z)(),[t,s]=(0,v.useState)(null),[n,u]=(0,v.useState)(null),[p,y]=(0,v.useState)([]),[g,m]=(0,v.useState)({thisYear:[],lastYear:[]}),[j,Z]=(0,v.useState)({solving:0,solved:0}),f=async()=>{try{var t;let a=await e.get("/api/v1/employees/me");s(a.data),console.log(a.data);let n=await e.get("/api/v1/departments/".concat(null===(t=a.data)||void 0===t?void 0:t.departmentUid));u(n.data)}catch(e){console.log(e)}},w=async()=>{try{let s=await e.get("/api/v1/issues/employee/".concat(null==t?void 0:t.uid)),a=s.data.issues,n=a.map(e=>({id:e.id,name:e.title,description:e.description,longitude:e.coordinates.longitude,latitude:e.coordinates.latitude,dateOfCreation:e.creationDate,status:e.status}));y(n),S(n)}catch(e){console.log(e)}},S=async s=>{try{if(t){let s=(0,O.Z)((0,R.Z)(new Date),"yyyy-MM-dd");console.log(s);let a=await e.get("api/v1/issues/employee/".concat(null==t?void 0:t.uid,"/count?from=").concat(s,"&statuses=SOLVED")),n=await e.get("api/v1/issues/employee/".concat(null==t?void 0:t.uid,"/count?from=").concat(s,"&statuses=SOLVING")),r=a.data.count,i=n.data.count;Z({solved:r,solving:i})}}catch(e){console.log(e)}},k=async()=>{try{if(t){console.log("zacatek year dat");let s=new Date().getFullYear(),a=s-1,n=Array.from({length:12},(e,t)=>t),r=n.map(async a=>{let n=(0,O.Z)(new Date(s,a,1),"yyyy-MM-dd"),r=(0,O.Z)((0,A.Z)(new Date(s,a)),"yyyy-MM-dd"),i=await e.get("api/v1/issues/employee/".concat(null==t?void 0:t.uid,"/count?from=").concat(n,"&to=").concat(r));return i.data.count}),i=n.map(async s=>{let n=(0,O.Z)(new Date(a,s,1),"yyyy-MM-dd"),r=(0,O.Z)((0,A.Z)(new Date(a,s)),"yyyy-MM-dd"),i=await e.get("api/v1/issues/employee/".concat(null==t?void 0:t.uid,"/count?from=").concat(n,"&to=").concat(r));return i.data.count}),[o,l]=await Promise.all([Promise.all(r),Promise.all(i)]);m({thisYear:o,lastYear:l}),console.log("yearly graph data"),console.log(g)}}catch(e){console.log(e)}};return(0,v.useEffect)(()=>{let e=async()=>{await f(),console.log("employee fetched")};e()},[]),(0,v.useEffect)(()=>{let e=async()=>{t&&(await w(),await k())};e()},[t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{children:(0,a.jsx)("title",{children:"Better City"})}),(0,a.jsxs)(i.Z,{component:"main",sx:{flexGrow:1,py:8},children:[(0,a.jsx)(o.Z,{container:!0,spacing:3,children:(0,a.jsx)(o.Z,{item:!0,xs:12,sx:{paddingTop:0},children:(0,a.jsx)(l.Z,{children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(d.Z,{variant:"h5",children:t?t.firstName+" "+t.lastName:null}),(0,a.jsxs)(d.Z,{variant:"subtitle1",children:["Department: ",n?n.name:null]}),(0,a.jsx)(d.Z,{variant:"body1",children:t?t.email:null})]})})})}),(0,a.jsx)(h.Z,{maxWidth:"xl",children:(0,a.jsxs)(o.Z,{container:!0,spacing:3,children:[(0,a.jsx)(o.Z,{xs:12,md:12,lg:8,children:(0,a.jsx)(x.n,{issues:p,sx:{height:"100%"}})}),(0,a.jsx)(o.Z,{xs:12,md:6,lg:4,children:(0,a.jsx)(Y,{chartSeries:[j.solving,j.solved],labels:["Solving","Solved"],sx:{height:"100%"}})}),(0,a.jsx)(o.Z,{xs:12,lg:8,children:(0,a.jsx)(b,{chartSeries:[{name:"This year",data:g.thisYear},{name:"Last year",data:g.lastYear}],sx:{height:"100%"}})})]})})]})]})};G.getLayout=e=>(0,a.jsx)(u.A,{children:e});var W=G},7344:function(e,t,s){"use strict";s.d(t,{n:function(){return O}});var a=s(5893),n=s(7294),r=s(5697),i=s.n(r),o=s(2743),l=s(6242),c=s(8445),d=s(9661),h=s(3219),u=s(7357),x=s(7906),p=s(3184),y=s(3816),g=s(8102),m=s(295),j=s(9305),Z=s(7720),f=s(2023),w=s(3321),v=s(2377),S=s(948);let b=(0,S.ZP)("span")(e=>{let{theme:t,ownerState:s}=e,a=t.palette[s.color].alpha12,n="dark"===t.palette.mode?t.palette[s.color].main:t.palette[s.color].dark;return{alignItems:"center",backgroundColor:a,borderRadius:12,color:n,cursor:"default",display:"inline-flex",flexGrow:0,flexShrink:0,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(12),lineHeight:2,fontWeight:600,justifyContent:"center",letterSpacing:.5,minWidth:20,paddingLeft:t.spacing(1),paddingRight:t.spacing(1),textTransform:"uppercase",whiteSpace:"nowrap"}}),k=e=>{let{color:t="primary",children:s,...n}=e;return(0,a.jsx)(b,{ownerState:{color:t},...n,children:s})};k.propTypes={children:i().node,color:i().oneOf(["primary","secondary","error","info","warning","success"])};var P=s(1590),C=s(5337),M=s(2912);let D={SOLVING:"warning",SOLVED:"success"},O=e=>{let{issues:t=[],sx:s}=e,[r,i]=(0,n.useState)(0),S=(e,t)=>{i(t)},b=t.slice(5*r,5*r+5),O=e=>{let t=(0,C.Z)(e,"yyyy-MM-dd'T'HH:mm:ss.SSSSSS",new Date);return t};return(0,a.jsxs)(l.Z,{sx:s,children:[(0,a.jsx)(c.Z,{avatar:(0,a.jsx)(d.Z,{sx:{backgroundColor:"warning.main",height:56,width:56,paddingBottom:0},children:(0,a.jsx)(h.Z,{children:(0,a.jsx)(P.Z,{})})}),title:"Your latest Issues"}),(0,a.jsx)(v.L,{sx:{flexGrow:1},children:(0,a.jsx)(u.Z,{sx:{minWidth:800,paddingTop:0},children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(p.Z,{children:(0,a.jsxs)(y.Z,{children:[(0,a.jsx)(g.Z,{children:" Issue Nr. "}),(0,a.jsx)(g.Z,{children:" What happened "}),(0,a.jsx)(g.Z,{children:" Location "}),(0,a.jsx)(g.Z,{sortDirection:"desc",children:" Date "}),(0,a.jsx)(g.Z,{children:" Status "})]})}),(0,a.jsx)(m.Z,{children:b.map(e=>{let t=(0,M.Z)(O(e.dateOfCreation),"dd/MM/yyyy");return(0,a.jsxs)(y.Z,{hover:!0,children:[(0,a.jsxs)(g.Z,{children:[" ",e.id," "]}),(0,a.jsxs)(g.Z,{children:[" ",e.name," "]}),(0,a.jsxs)(g.Z,{children:[" ",e.latitude,", ",e.longitude," "]}),(0,a.jsxs)(g.Z,{children:[" ",t," "]}),(0,a.jsx)(g.Z,{children:(0,a.jsx)(k,{color:D[e.status],children:e.status})})]},e.id)})})]})})}),(0,a.jsx)(j.Z,{component:"div",count:t.length,rowsPerPage:5,page:r,onPageChange:S,rowsPerPageOptions:[]}),(0,a.jsx)(Z.Z,{}),(0,a.jsx)(f.Z,{sx:{justifyContent:"flex-end"},children:(0,a.jsx)(w.Z,{color:"inherit",endIcon:(0,a.jsx)(h.Z,{fontSize:"small",children:(0,a.jsx)(o.Z,{})}),size:"small",variant:"text",children:"View all"})})]})};O.propTypes={issues:i().array,sx:i().object}},6822:function(e,t,s){"use strict";var a=s(5121);let n=()=>{let e=a.Z.create({baseURL:"https://bettercity.mikita.dev",timeout:8e3,headers:{Authorization:"Bearer "+window.sessionStorage.getItem("token")}});return e};t.Z=n}},function(e){e.O(0,[823,549,837,703,258,879,331,334,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);